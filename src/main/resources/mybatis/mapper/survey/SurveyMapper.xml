<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.spring.springbootmybatisproject.survey.repository.SurveyMapper">


    <!-- 설문 항목 불러오기 -->
    <select id="findBySurveyListAll" resultType="SurveyItemVO">
        SELECT itemId
             , groupCd
             , itemCd
             , itemNm
             , itemComm
        FROM bbs_survey_item_cd
    </select>

    <!-- 설문 항목 저장 -->
    <insert id="registerSurveyList" parameterType="SurveyVO" useGeneratedKeys="true" keyProperty="surveyId">
        INSERT INTO bbs_survey ( surveyId
                               , majorItem
                               , nonMajorStudyItem
                               , ageItem
                               , careerItem
                               , incomeItem
                               , jobItem
                               , useOSItem
                               , useDBItem
                               , useEditorItem
                               , confidentLangItem
                               , confidentLangItem2
                               , learnLangItem
                               , learnLangItem2
                               , accountId)
        VALUES ( #{surveyId}, #{majorItem}, #{nonMajorStudyItem}, #{ageItem}, #{careerItem}, #{incomeItem}
               , #{jobItem}, #{useOSItem}, #{useDBItem}, #{useEditorItem}, #{confidentLangItem}, #{confidentLangItem2}
               , #{learnLangItem}, #{learnLangItem2}, #{accountId});
    </insert>


    <select id="findBySurveyMajorItemRes" resultType="SurveyResult">
        <![CDATA[
        SELECT (CASE
                    WHEN bs.majorItem = 'MAJ' THEN '전공'
                    WHEN bs.majorItem = 'NMAJ' THEN '비전공'
            END) as majorItem,
               count(bs.majorItem) as majorValue
        FROM bbs_new_account ba
                 LEFT JOIN bbs_survey bs ON ba.accountId = bs.accountId
        WHERE devCheck = 'P'
        GROUP BY bs.majorItem
        HAVING bs.majorItem is not null
        ]]>
    </select>
</mapper>